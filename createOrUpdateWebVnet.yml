- name: Create Azure WebApp with Vnet
  hosts: ansible-azure
  gather_facts: false
  tasks:
   - name: Run ARM template
     azure_rm_deployment:
      state: present
      resource_group_name: "z-{{ hostvars[0]['opco_code'] }}-{{ hostvars[0]['project_code'] }}-{{ hostvars[0]['app_code'] }}-{{ hostvars[0]['env_code'] }}-{{ hostvars[0]['location_code'] }}-rg"
      location: westeurope
      tags:
        from: ansible
      template_link: "https://raw.githubusercontent.com/Ineaweb/templateARM/master/template-Vnet-Web.json"
      parameters:
        location_code:
          value: "{{ hostvars[0]['location_code'] }}"
        opco_code:
          value: "{{ hostvars[0]['opco_code'] }}"
        project_code:
          value: "{{ hostvars[0]['project_code'] }}"
        app_code:
          value: "{{ hostvars[0]['app_code'] }}"
        env_code:
          value: "{{ hostvars[0]['env_code'] }}"
        location_name:
          value: "West Europe"
        rev_number:
          value: "1.0.0.1"
        dcs_code:
          value: FIN
        client_billingCode:
          value: "XXXXX"
        project_billingCode:
          value: "XXXXX"
        start_time:
          value: "0 8 ***" 
        stop_time:
          value: "0 19 ***"
        launch_time:
          value: "1453739311"
        time_to_live:
          value: "15000"                                              
